function cache_store(e,a,t,o,c){if("undefined"==typeof Storage)return!1;var n="cached-"+t+"-"+e+"-"+a;void 0===c&&(c=Math.floor((new Date).getTime()/1e3));var i={component:e,identifier:a,version:c,data:o};try{localStorage.setItem(n,JSON.stringify(i))}catch(e){cache_flush();try{localStorage.setItem(n,JSON.stringify(i))}catch(e){return!1}}return i}function cache_fetch(e,a,t){if("undefined"==typeof Storage)return!1;var o="cached-"+t+"-"+e+"-"+a;return data=localStorage.getItem(o),null!==data&&JSON.parse(data)}function cache_delete(e,a,t){if("undefined"==typeof Storage)return!1;var o="cached-"+t+"-"+e+"-"+a;return localStorage.removeItem(o),!0}function cache_flush(){if("undefined"==typeof Storage)return!1;for(var e=0;e<localStorage.length;e++){var a=localStorage.key(e).substring(0,12);if("cached-view-"==a||"cached-data-"==a){var t=localStorage.key(e);localStorage.removeItem(t)}}}function validate_cacheable_views(){var t=!1,o=Cookies.getJSON("cached_views");void 0!==o&&$.each(o,function(e,a){!1===cache_fetch(a.component,a.identifier,"view")&&(delete o[e],t=!0)}),!0===t&&($.isEmptyObject(o)?Cookies.remove("cached_views"):Cookies.set("cached_views",o));for(var e=0;e<localStorage.length;e++)if("cached-view-"==localStorage.key(e).substring(0,12)){var a=localStorage.key(e),c=JSON.parse(localStorage.getItem(a));announce_cacheable_view(c.component,c.identifier,c.version)}}function process_cacheable_views(){$('div[data-type="cacheable"]').each(function(){var e=$(this).attr("data-component"),a=$(this).attr("data-identifier"),t=$(this).attr("data-version"),o=$(this).html();""===o?!1===(o=cache_fetch(e,a,"view"))?load_cacheable_view(e,a,this):$(this).html(o.data):!1!==cache_store(e,a,"view",o,t)&&announce_cacheable_view(e,a,t)})}function announce_cacheable_view(e,a,t){var o=e+"-"+a,c=Cookies.getJSON("cached_views");void 0===c&&(c={}),(!c.hasOwnProperty(o)||c.hasOwnProperty(o)&&c[o].version!=t)&&(c[o]={component:e,identifier:a,version:t},Cookies.set("cached_views",c))}$="undefined"==typeof $&&"undefined"!=typeof jQuery?jQuery:$,$(document).ready(function(){var e=performance.now();validate_cacheable_views(),process_cacheable_views();var a=performance.now();console.log("Execution of view validation and processing takes: "+(a-e)+" ms.")});var fallback_destination="http://localhost/caching/index.php";function load_cacheable_view(a,t,o){var e=fallback_destination+"?component="+a+"&identifier="+t;$.ajax({url:e}).done(function(e){data=JSON.parse(e),!1!==cache_store(a,t,"view",data.data,data.version)&&announce_cacheable_view(a,t,data.version),$(o).html(data.data),console.log("Load view from endpoint ...")})}function cacheable_request(a,t,o,e){var c=cache_fetch(a,t,"data"),n=0;!1!==c&&(n=c.version),e=e+"component="+a+"&identifier="+t+"&version="+n,$.ajax({url:e}).done(function(e){"up-to-date"!==e&&(e=JSON.parse(e),c=cache_store(a,t,"data",e.data,e.version)),o(c)})}
